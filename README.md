# Smart Forward - æ™ºèƒ½ç½‘ç»œè½¬å‘å™¨ v1.5.2

[![ğŸš€ å…¨å¹³å°å‘å¸ƒ](https://github.com/cls3389/smart-forward/actions/workflows/release.yml/badge.svg)](https://github.com/cls3389/smart-forward/actions/workflows/release.yml)
[![License](https://img.shields.io/badge/license-MIT-blue.svg)](LICENSE)
[![Rust](https://img.shields.io/badge/rust-1.70+-orange.svg)](https://www.rust-lang.org)

ä¸€ä¸ªé«˜æ€§èƒ½çš„æ™ºèƒ½ç½‘ç»œè½¬å‘å™¨ï¼Œæ”¯æŒ TCPã€UDPã€HTTP åè®®è½¬å‘ï¼Œå…·æœ‰åŠ¨æ€åœ°å€è§£æã€æ•…éšœè½¬ç§»å’Œå¥åº·æ£€æŸ¥åŠŸèƒ½ã€‚æ”¯æŒç”¨æˆ·æ€å’Œå†…æ ¸æ€è½¬å‘ï¼Œåœ¨OpenWrtç­‰èµ„æºå—é™ç¯å¢ƒä¸‹æä¾›æè‡´æ€§èƒ½ã€‚

## âœ¨ åŠŸèƒ½ç‰¹æ€§

- ğŸš€ **å¤šåè®®æ”¯æŒ**: TCPã€UDPã€HTTP åè®®è½¬å‘ï¼Œé»˜è®¤TCP+UDPåŒåè®®ç›‘å¬
- ğŸ”„ **æ™ºèƒ½æ•…éšœè½¬ç§»**: è‡ªåŠ¨æ£€æµ‹ç›®æ ‡æœåŠ¡å™¨çŠ¶æ€å¹¶åˆ‡æ¢
- ğŸŒ **åŠ¨æ€åœ°å€è§£æ**: æ”¯æŒ A/AAAA è®°å½•å’Œ TXT è®°å½•è§£æ
- âš¡ **å†…æ ¸æ€è½¬å‘**: Linuxä¸‹æ”¯æŒiptables/nftableså†…æ ¸çº§è½¬å‘ï¼Œæ€§èƒ½æå‡10å€+
- ğŸ”§ **æ··åˆæ¨¡å¼**: ç”¨æˆ·æ€å¥åº·æ£€æŸ¥ + å†…æ ¸æ€æ•°æ®è½¬å‘ï¼Œæ™ºèƒ½æ•…éšœåˆ‡æ¢
- ğŸ›¡ï¸ **é˜²ç«å¢™ä¼˜åŒ–**: è‡ªåŠ¨å¤„ç†Firewall4ä¼˜å…ˆçº§ï¼Œé¿å…è§„åˆ™å†²çª
- ğŸ”§ **çµæ´»é…ç½®**: YAML é…ç½®æ–‡ä»¶ï¼Œæ”¯æŒå¤šè§„åˆ™é…ç½®
- ğŸ“Š **å¥åº·æ£€æŸ¥**: è‡ªåŠ¨ç›‘æ§ç›®æ ‡æœåŠ¡å™¨çŠ¶æ€
- ğŸ”’ **AutoHTTP**: è‡ªåŠ¨HTTPè·³è½¬HTTPSï¼Œæ™ºèƒ½ç«¯å£æ£€æµ‹
- ğŸƒ **è½»é‡é«˜æ•ˆ**: ä¸“ä¸ºè·¯ç”±å™¨ç­‰èµ„æºå—é™ç¯å¢ƒä¼˜åŒ–

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…

#### ğŸ“¦ åŸç”Ÿç³»ç»Ÿå®‰è£… (æ¨è)
```bash
# äº¤äº’å¼å®‰è£…è„šæœ¬ - è‡ªåŠ¨æ£€æµ‹Linux/OpenWrtç¯å¢ƒ
curl -fsSL https://raw.githubusercontent.com/cls3389/smart-forward/main/install.sh | bash

# æˆ–ä½¿ç”¨ wget
wget -qO- https://raw.githubusercontent.com/cls3389/smart-forward/main/install.sh | bash
```

**ğŸ’¡ æç¤º**: Dockerç”¨æˆ·è¯·ç›´æ¥ä½¿ç”¨Dockerå‘½ä»¤ï¼Œæ­¤è„šæœ¬ä»…ç”¨äºåŸç”ŸLinux/OpenWrtç³»ç»Ÿå®‰è£…

**å®‰è£…ç‰¹æ€§**:
- ğŸ” **è‡ªåŠ¨æ£€æµ‹**: è‡ªåŠ¨è¯†åˆ«Linuxæˆ–OpenWrtç¯å¢ƒ
- ğŸ›ï¸ **äº¤äº’å¼é…ç½®**: é€‰æ‹©ç›‘å¬åœ°å€å’Œè½¬å‘è§„åˆ™
- ğŸ“‹ **æ™ºèƒ½å‡çº§**: ä¿ç•™ç°æœ‰é…ç½®ï¼Œæ¸…ç†æ—§ç¨‹åº
- âš™ï¸ **é›¶é…ç½®**: é»˜è®¤é…ç½®å³å¯è¿è¡Œï¼Œæ”¯æŒåç»­ä¿®æ”¹

### 2. é…ç½®

ç¼–è¾‘ `config.yaml` é…ç½®æ–‡ä»¶ï¼ˆå·²åŒ…å«å®Œæ•´çš„ç”Ÿäº§é…ç½®ç¤ºä¾‹ï¼‰ï¼š

```yaml
# ç½‘ç»œé…ç½®
network:
  listen_addrs:
    - "10.5.1.1"    # æŒ‡å®šå…·ä½“IPé¿å…åŠ«æŒ

# è½¬å‘è§„åˆ™
rules:
  - name: "HTTPS"
    listen_port: 443
    protocol: "tcp"
    targets:
      - "192.168.5.254:443"
      - "121.40.167.222:50443"
      - "stun-443.4.ipto.top"
```

### 3. å¯åŠ¨

```bash
# å‰å°è¿è¡Œï¼ˆæ¨èç”¨äºæµ‹è¯•ï¼‰
./start.sh

# åå°è¿è¡Œï¼ˆæ¨èç”¨äºç”Ÿäº§ï¼‰
./start.sh daemon

# åœæ­¢æœåŠ¡
./stop.sh
```

**ç‰¹æ€§**:
- ğŸ” **è‡ªåŠ¨æ£€æµ‹**: Linuxã€OpenWrtã€Dockerç¯å¢ƒ
- ğŸš€ **ä¼˜å…ˆå†…æ ¸æ€**: è‡ªåŠ¨å¯ç”¨å†…æ ¸æ€è½¬å‘ï¼Œæ™ºèƒ½å›é€€ç”¨æˆ·æ€
- ğŸŒ **IPv4/IPv6**: æ”¯æŒç°ä»£æ··åˆç½‘ç»œç¯å¢ƒ
- âš¡ **é›¶é…ç½®**: å¼€ç®±å³ç”¨ï¼Œè‡ªåŠ¨ä¼˜åŒ–

#### ğŸ³ Docker å®¹å™¨éƒ¨ç½²
```bash
# ç”¨æˆ·æ€è½¬å‘ (æ¨èï¼Œè·¨å¹³å°å…¼å®¹)
docker run -d --name smart-forward --network host \
  -v $(pwd)/config.yaml:/app/config.yaml:ro \
  ghcr.io/cls3389/smart-forward:latest

# å†…æ ¸æ€è½¬å‘ (Linuxé«˜æ€§èƒ½ï¼Œéœ€è¦ç‰¹æƒæ¨¡å¼)
docker run -d --name smart-forward --privileged --network host \
  -v $(pwd)/config.yaml:/app/config.yaml:ro \
  ghcr.io/cls3389/smart-forward:latest \
  --kernel-mode
```

**ğŸ’¡ Docker vs åŸç”Ÿå®‰è£…**:
- ğŸ³ **Docker**: å®¹å™¨åŒ–éƒ¨ç½²ï¼Œæ˜“äºåˆ†å‘å’Œç®¡ç†
- ğŸ–¥ï¸ **åŸç”Ÿå®‰è£…**: ç›´æ¥å®‰è£…åˆ°ç³»ç»Ÿï¼Œæ€§èƒ½æ›´å¥½ï¼Œèµ„æºå ç”¨æ›´å°‘

#### ğŸ’¾ æ‰‹åŠ¨ä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶
[ğŸ“¥ GitHub Releases](https://github.com/cls3389/smart-forward/releases/latest) - æ”¯æŒ Windowsã€macOSã€Linux

#### ğŸŸ¢ ç®€å•å¯åŠ¨è„šæœ¬ (å°ç™½å‹å¥½)
```bash
# å¿«é€Ÿå¯åŠ¨
./start.sh

# å¿«é€Ÿåœæ­¢
./stop.sh

# æŸ¥çœ‹çŠ¶æ€
ps aux | grep smart-forward
```

**ğŸ’¡ å°ç™½ç”¨æˆ·æç¤º**:
- âœ… **ä¸€é”®å¯åŠ¨**: `./start.sh` - è‡ªåŠ¨æ£€æŸ¥é…ç½®å¹¶å¯åŠ¨æœåŠ¡
- âœ… **ä¸€é”®åœæ­¢**: `./stop.sh` - å®‰å…¨åœæ­¢æœåŠ¡ï¼Œæ”¯æŒå¼ºåˆ¶åœæ­¢
- âœ… **æ™ºèƒ½æ£€æŸ¥**: è‡ªåŠ¨æ£€æŸ¥é…ç½®æ–‡ä»¶æ˜¯å¦å­˜åœ¨
- âœ… **å‹å¥½æç¤º**: å½©è‰²è¾“å‡ºï¼Œæ¸…æ™°çš„çŠ¶æ€ä¿¡æ¯

### 2. è¿è¡Œ

```bash
# è‡ªåŠ¨æ¨¡å¼ï¼ˆæ¨èï¼‰
./smart-forward

# å¼ºåˆ¶ç”¨æˆ·æ€è½¬å‘ï¼ˆè·¨å¹³å°å…¼å®¹ï¼‰
./smart-forward --user-mode

# å¼ºåˆ¶å†…æ ¸æ€è½¬å‘ï¼ˆLinuxé«˜æ€§èƒ½æ¨¡å¼ï¼Œéœ€è¦rootæƒé™ï¼‰
./smart-forward --kernel-mode

# ç³»ç»ŸæœåŠ¡ç®¡ç†ï¼ˆå®‰è£…åè‡ªåŠ¨é…ç½®ï¼‰
# OpenWrt:
# å¯åŠ¨æœåŠ¡: /etc/init.d/smart-forward start
# æŸ¥çœ‹çŠ¶æ€: /etc/init.d/smart-forward status
# æŸ¥çœ‹æ—¥å¿—: logread | grep smart-forward

# Linux:
# å¯åŠ¨æœåŠ¡: systemctl start smart-forward  # æˆ– sudo systemctl start smart-forward
# æŸ¥çœ‹çŠ¶æ€: systemctl status smart-forward  # æˆ– sudo systemctl status smart-forward
# æŸ¥çœ‹æ—¥å¿—: journalctl -u smart-forward -f  # æˆ– sudo journalctl -u smart-forward -f
```

## ğŸ“Š æ—¥å¿—æŸ¥çœ‹

### ç®€åŒ–æ—¥å¿—æŸ¥çœ‹
```bash
# åå°è¿è¡Œæ—¶çš„æ—¥å¿—æ–‡ä»¶
tail -f /tmp/smart-forward.log          # æ‰‹åŠ¨åå°æ¨¡å¼
tail -f /var/log/smart-forward.log      # Linux systemd

# ç³»ç»Ÿæ—¥å¿—
# OpenWrt:
logread -f | grep smart-forward

# Linux:
sudo journalctl -u smart-forward -f
```

### æ—¥å¿—çº§åˆ«è¯´æ˜
- **INFO**: æ­£å¸¸è¿è¡Œä¿¡æ¯ï¼ˆå¯åŠ¨ã€æœåŠ¡çŠ¶æ€ã€å¥åº·æ£€æŸ¥ç­‰ï¼‰
- **WARN**: è­¦å‘Šä¿¡æ¯ï¼ˆç«¯å£å ç”¨ã€ç›®æ ‡å¼‚å¸¸ç­‰ï¼‰
- **ERROR**: é”™è¯¯ä¿¡æ¯ï¼ˆé…ç½®æ–‡ä»¶é”™è¯¯ã€æƒé™ä¸è¶³ç­‰ï¼‰
- **DEBUG**: è°ƒè¯•ä¿¡æ¯ï¼ˆè¯¦ç»†çš„å†…éƒ¨çŠ¶æ€å˜åŒ–ï¼‰

### è¿è¡Œæ¨¡å¼è¯†åˆ«
- **å†…æ ¸æ€è½¬å‘**: æ—¥å¿—æ˜¾ç¤º `ğŸš€ å†…æ ¸æ€è½¬å‘æ¨¡å¼`ï¼Œæ— ç«¯å£ç›‘å¬ï¼Œæœ‰nftablesè§„åˆ™
- **ç”¨æˆ·æ€è½¬å‘**: æ—¥å¿—æ˜¾ç¤ºç«¯å£ç›‘å¬ï¼Œæ— nftablesè§„åˆ™

## ğŸ“š æ–‡æ¡£

æ‰€æœ‰é…ç½®å’Œæ•…éšœæ’é™¤ä¿¡æ¯å·²æ•´åˆåˆ°æœ¬READMEä¸­ï¼ŒåŒ…æ‹¬ï¼š
- âš™ï¸ **é…ç½®è¯´æ˜** - å®Œæ•´çš„é…ç½®é€‰é¡¹å’Œç¤ºä¾‹
- ğŸ”§ **æ•…éšœæ’é™¤** - å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ
- ğŸ“Š **æ—¥å¿—æŸ¥çœ‹** - è¯¦ç»†çš„æ—¥å¿—åˆ†ææ–¹æ³•

## ğŸ“ é¡¹ç›®ç»“æ„

```
smart-forward/
â”œâ”€â”€ ğŸ“ src/                    # ğŸ¦€ Rust æºä»£ç 
â”œâ”€â”€ ğŸ“ docker/                 # ğŸ³ Docker é…ç½®æ–‡ä»¶ (ç‹¬ç«‹éƒ¨ç½²ä½¿ç”¨)
â”œâ”€â”€ ğŸ“„ install.sh              # ğŸš€ åŸç”Ÿç³»ç»Ÿå®‰è£…è„šæœ¬ (Linux/OpenWrt)
â”œâ”€â”€ ğŸ“„ start.sh                # ğŸŸ¢ ç®€å•å¯åŠ¨è„šæœ¬ (å°ç™½å‹å¥½)
â”œâ”€â”€ ğŸ“„ stop.sh                 # ğŸ”´ ç®€å•åœæ­¢è„šæœ¬ (å°ç™½å‹å¥½)
â”œâ”€â”€ ğŸ“„ config.yaml            # âš™ï¸  ä¸»é…ç½®æ–‡ä»¶ (ç”Ÿäº§é…ç½®)
â”œâ”€â”€ ğŸ“„ config.yaml.example     # ğŸ¯ é…ç½®æ–‡ä»¶ç¤ºä¾‹
â”œâ”€â”€ ğŸ“„ README.md               # ğŸ“– å®Œæ•´æ–‡æ¡£
â””â”€â”€ ğŸ—ï¸ Cargo.toml              # ğŸ“¦ Rust é¡¹ç›®é…ç½®
```

**æ–‡ä»¶è¯´æ˜**:
- âœ… **åŸç”Ÿå®‰è£…è„šæœ¬** - ä¸“é—¨ç”¨äºLinux/OpenWrtç³»ç»Ÿçš„åŸç”Ÿå®‰è£…
- âœ… **ç®€å•å¯åŠ¨è„šæœ¬** - å°ç™½å‹å¥½çš„å¿«é€Ÿå¯åŠ¨/åœæ­¢å·¥å…·
- âœ… **æ ¸å¿ƒé…ç½®æ–‡ä»¶** - åŒ…å«å®Œæ•´ç”Ÿäº§é…ç½®ç¤ºä¾‹
- âœ… **ç»Ÿä¸€æ–‡æ¡£** - READMEåŒ…å«æ‰€æœ‰å¿…è¦ä¿¡æ¯
- âœ… **ç”¨æˆ·å‹å¥½** - æä¾›å¤šç§éƒ¨ç½²é€‰æ‹©ï¼Œç…§é¡¾ä¸åŒç”¨æˆ·ç¾¤ä½“

## ğŸ“ˆ ç‰ˆæœ¬æ›´æ–°

### v1.5.2 (2025-09-20) ğŸš€ **ç”¨æˆ·å‹å¥½ + ç®€å•å¯åŠ¨**
ğŸ”¥ **å°ç™½å‹å¥½ + å¤šç§éƒ¨ç½²é€‰æ‹©**

âš¡ **æ ¸å¿ƒæ”¹è¿›**ï¼š
- **ç®€å•å¯åŠ¨è„šæœ¬** - `./start.sh` å’Œ `./stop.sh` ç…§é¡¾å°ç™½ç”¨æˆ·
- **åŸç”Ÿå®‰è£…è„šæœ¬** - ä¸“é—¨ç”¨äºLinux/OpenWrtç³»ç»Ÿçš„åŸç”Ÿå®‰è£…
- **Dockerç¯å¢ƒæ£€æµ‹** - è‡ªåŠ¨è¯†åˆ«Dockerå®¹å™¨ç¯å¢ƒå¹¶ç»™å‡ºæŒ‡å¯¼
- **éƒ¨ç½²æ–¹å¼åˆ†ç¦»** - åŸç”Ÿå®‰è£…å’ŒDockeréƒ¨ç½²å„å¸å…¶èŒ

ğŸ›ï¸ **äº¤äº’ç‰¹æ€§**ï¼š
- **ç½‘ç»œæ¥å£æ£€æµ‹** - è‡ªåŠ¨è¯†åˆ«å¯ç”¨ç½‘ç»œæ¥å£å’ŒIPåœ°å€
- **ç›‘å¬åœ°å€é…ç½®** - é€‰æ‹©å…·ä½“IPæˆ–ç›‘å¬æ‰€æœ‰æ¥å£(0.0.0.0)
- **è½¬å‘è§„åˆ™é…ç½®** - äº¤äº’å¼æ·»åŠ HTTPã€HTTPSã€RDPç­‰è½¬å‘è§„åˆ™
- **é…ç½®é¢„è§ˆ** - å®‰è£…å‰æ˜¾ç¤ºé…ç½®å†…å®¹ä¾›ç¡®è®¤

ğŸ›¡ï¸ **å®‰è£…ç‰¹æ€§**ï¼š
- **è·¨å¹³å°å…¼å®¹** - è‡ªåŠ¨æ£€æµ‹å¹¶é€‚é…Linux/OpenWrtç¯å¢ƒ
- **é…ç½®ä¿æŠ¤** - å‡çº§æ—¶è‡ªåŠ¨å¤‡ä»½ç”¨æˆ·é…ç½®æ–‡ä»¶
- **æœåŠ¡ç®¡ç†** - è‡ªåŠ¨é…ç½®systemd/procdæœåŠ¡
- **è·¯å¾„ç»Ÿä¸€** - è§£å†³äºŒè¿›åˆ¶æ–‡ä»¶è·¯å¾„ä¸ä¸€è‡´é—®é¢˜

ğŸ¯ **éƒ¨ç½²é€‰æ‹©**ï¼š
- ğŸŸ¢ **ç®€å•å¯åŠ¨**: `./start.sh` - å°ç™½å‹å¥½çš„å¿«é€Ÿå¯åŠ¨
- ğŸ–¥ï¸ **åŸç”Ÿå®‰è£…**: `install.sh` - é€‚åˆç”Ÿäº§ç¯å¢ƒçš„é«˜æ€§èƒ½å®‰è£…
- ğŸ³ **Dockeréƒ¨ç½²**: `docker run` - é€‚åˆå¼€å‘æµ‹è¯•çš„å®¹å™¨åŒ–éƒ¨ç½²
- ğŸ“¦ **æ‰‹åŠ¨ä¸‹è½½**: GitHub Releases - çµæ´»éƒ¨ç½²ï¼Œæ”¯æŒæ›´å¤šå¹³å°

### v1.5.0 (2025-09-20) ğŸš€ **å†…æ ¸æ€è½¬å‘é‡å¤§æ›´æ–°**
ğŸ”¥ **é©å‘½æ€§æ€§èƒ½æå‡ - å†…æ ¸æ€è½¬å‘æ”¯æŒ**

âš¡ **æ ¸å¿ƒåŠŸèƒ½**ï¼š
- **å†…æ ¸æ€è½¬å‘** - Linuxä¸‹æ”¯æŒiptables/nftablesï¼Œæ€§èƒ½æå‡10å€+
- **æ··åˆæ¶æ„** - ç”¨æˆ·æ€å¥åº·æ£€æŸ¥ + å†…æ ¸æ€æ•°æ®è½¬å‘
- **æ™ºèƒ½æ¨¡å¼** - è‡ªåŠ¨å°è¯•å†…æ ¸æ€ï¼Œå¤±è´¥å›é€€ç”¨æˆ·æ€
- **é˜²ç«å¢™ä¼˜åŒ–** - è‡ªåŠ¨å¤„ç†Firewall4ä¼˜å…ˆçº§ï¼Œé¿å…è§„åˆ™å†²çª

ğŸ›¡ï¸ **é˜²ç«å¢™æ”¯æŒ**ï¼š
- **nftables** - ä¼˜å…ˆçº§-150 (é«˜äºFirewall4é»˜è®¤-100)
- **iptables** - æ’å…¥åˆ°é“¾é¦–ä½ç½®ï¼Œç¡®ä¿ä¼˜å…ˆæ‰§è¡Œ
- **è‡ªåŠ¨æ£€æµ‹** - æ™ºèƒ½é€‰æ‹©æœ€ä½³é˜²ç«å¢™åç«¯

ğŸ¯ **OpenWrtä¸“é¡¹ä¼˜åŒ–**ï¼š
- **ä¸€é”®å®‰è£…è„šæœ¬** - è‡ªåŠ¨æ£€æµ‹æ¶æ„å¹¶å®‰è£…
- **procdæœåŠ¡ç®¡ç†** - å®Œæ•´çš„OpenWrtæœåŠ¡é›†æˆ
- **èµ„æºä¼˜åŒ–** - ä¸“ä¸ºè·¯ç”±å™¨æ€§èƒ½ä¼˜åŒ–

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

| è½¬å‘æ¨¡å¼ | å»¶è¿Ÿ | ååé‡ | CPUå ç”¨ | å†…å­˜å ç”¨ | é€‚ç”¨åœºæ™¯ |
|---------|------|--------|---------|----------|----------|
| **å†…æ ¸æ€è½¬å‘** | < 0.1ms | 10Gbps+ | < 5% | < 10MB | é«˜æ€§èƒ½ç”Ÿäº§ç¯å¢ƒ |
| **ç”¨æˆ·æ€è½¬å‘** | 1-2ms | 1Gbps | 10-20% | 20-50MB | å¼€å‘æµ‹è¯•ç¯å¢ƒ |

> ğŸš€ **å†…æ ¸æ€è½¬å‘ä¼˜åŠ¿**ï¼šæ•°æ®åŒ…ç›´æ¥åœ¨å†…æ ¸ç©ºé—´å¤„ç†ï¼Œé¿å…ç”¨æˆ·æ€/å†…æ ¸æ€åˆ‡æ¢å¼€é”€ï¼Œç‰¹åˆ«é€‚åˆOpenWrtç­‰èµ„æºå—é™ç¯å¢ƒã€‚

## ğŸ¯ ç‰¹è‰²åŠŸèƒ½

### AutoHTTP è‡ªåŠ¨è·³è½¬
å½“é…ç½®äº†443ç«¯å£ä½†æ²¡æœ‰80ç«¯å£æ—¶ï¼Œè‡ªåŠ¨å¯ç”¨HTTPâ†’HTTPSè·³è½¬ï¼š
```
âœ… æ£€æµ‹åˆ°HTTPSé…ç½®ä½†æ— HTTPé…ç½®ï¼Œè‡ªåŠ¨å¯ç”¨HTTPè·³è½¬æœåŠ¡
âœ… HTTPç›‘å¬å™¨ç»‘å®šåˆ°: 0.0.0.0:80
âœ… HTTPè½¬å‘å™¨å¯åŠ¨æˆåŠŸ: AutoHTTP
```

### TCP+UDP åŒåè®®æ”¯æŒ
é»˜è®¤æƒ…å†µä¸‹ï¼ŒæœªæŒ‡å®šåè®®çš„è§„åˆ™åŒæ—¶ç›‘å¬TCPå’ŒUDPï¼š
```
âœ… TCPç›‘å¬å™¨ RDP_TCP ç»‘å®šæˆåŠŸ: 0.0.0.0:99
âœ… UDPç›‘å¬å™¨ç»‘å®šæˆåŠŸ: 0.0.0.0:99
```

### å†…æ ¸æ€è½¬å‘ (Linux)
é«˜æ€§èƒ½å†…æ ¸çº§æ•°æ®è½¬å‘ï¼Œæ”¯æŒæ™ºèƒ½æ•…éšœåˆ‡æ¢ï¼š
```bash
# è‡ªåŠ¨æ¨¡å¼ (æ¨è)
./smart-forward

# æ‰‹åŠ¨æŒ‡å®šé˜²ç«å¢™åç«¯
sudo ./smart-forward --kernel-mode --firewall-backend nftables
sudo ./smart-forward --kernel-mode --firewall-backend iptables

# æŸ¥çœ‹å†…æ ¸è§„åˆ™
sudo nft list table inet smart_forward  # nftables
sudo iptables -t nat -L SMART_FORWARD_PREROUTING  # iptables
```

### æ™ºèƒ½æ•…éšœè½¬ç§»
æŒ‰ä¼˜å…ˆçº§è‡ªåŠ¨åˆ‡æ¢ç›®æ ‡æœåŠ¡å™¨ï¼š
```yaml
targets:
  - "primary.example.com:443"    # ä¼˜å…ˆçº§1
  - "backup.example.com:443"     # ä¼˜å…ˆçº§2  
  - "fallback.example.com:443"   # ä¼˜å…ˆçº§3
```

## ğŸ”§ å¼€å‘æ„å»º

```bash
# å®‰è£… Rust
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh

# å…‹éš†ä»“åº“
git clone https://github.com/cls3389/smart-forward.git
cd smart-forward

# ç¼–è¯‘
cargo build --release

# è¿è¡Œ
./target/release/smart-forward -c config.yaml
```

## ğŸ¤ è´¡çŒ®

æ¬¢è¿è´¡çŒ®ä»£ç ï¼è¯·ç›´æ¥æäº¤ Pull Request æˆ– Issueã€‚

## âš™ï¸ é…ç½®è¯´æ˜

### åŸºç¡€é…ç½®
```yaml
# æ—¥å¿—é…ç½®
logging:
  level: "info"           # æ—¥å¿—çº§åˆ«: trace, debug, info, warn, error
  format: "text"          # æ—¥å¿—æ ¼å¼: text (OpenWrtæ¨è), json (Linuxæ¨è)

# ç½‘ç»œé…ç½®
network:
  listen_addrs:
    - "10.5.1.1"    # æŒ‡å®šç›‘å¬åœ°å€ï¼Œé¿å…åŠ«æŒæ‰€æœ‰è¯·æ±‚
                     # è®¾ç½®0.0.0.0ä¼šç›‘å¬æ‰€æœ‰æ¥å£ï¼Œè¯·è°¨æ…ä½¿ç”¨

# ç¼“å†²åŒºå¤§å° (ä»…ç”¨æˆ·æ€æ¨¡å¼æœ‰æ•ˆï¼Œå†…æ ¸æ€æ¨¡å¼å¿½ç•¥)
buffer_size: 8192

# å…¨å±€åŠ¨æ€æ›´æ–°é…ç½®
dynamic_update:
  check_interval: 5       # å¥åº·æ£€æŸ¥é—´éš” (ç§’)
  connection_timeout: 2   # è¿æ¥è¶…æ—¶ (ç§’)
  auto_reconnect: true    # è‡ªåŠ¨é‡è¿

# è½¬å‘è§„åˆ™
rules:
  - name: "HTTPS"
    listen_port: 443
    protocol: "tcp"        # tcp, udp, æˆ– ["tcp", "udp"]
    buffer_size: 4096      # è§„åˆ™çº§ç¼“å†²åŒºå¤§å°
    targets:
      - "192.168.1.100:443"  # å†…ç½‘æœåŠ¡å™¨ (æœ€é«˜ä¼˜å…ˆçº§)
      - "backup.example.com:443"  # å¤–ç½‘å¤‡ç”¨
    dynamic_update:
      check_interval: 5
      connection_timeout: 2
      auto_reconnect: true
```

### é«˜çº§é…ç½®
```yaml
# å¤šåè®®è½¬å‘
rules:
  - name: "RDP"
    listen_port: 3389
    protocol: ["tcp", "udp"]  # åŒæ—¶æ”¯æŒTCPå’ŒUDP
    targets:
      - "192.168.1.10:3389"

# TXTè®°å½•è§£æ (åŠ¨æ€IP)
rules:
  - name: "Dynamic"
    listen_port: 8080
    protocol: "tcp"
    targets:
      - "dynamic.example.com"  # è‡ªåŠ¨è§£æTXTè®°å½•
```

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. å†…æ ¸æ€è½¬å‘å¤±è´¥
**ç—‡çŠ¶**: æ—¥å¿—æ˜¾ç¤º `å†…æ ¸æ€è½¬å‘åˆå§‹åŒ–å¤±è´¥`
```bash
# æ£€æŸ¥é˜²ç«å¢™åç«¯
sudo nft --version  # nftables
sudo iptables --version  # iptables

# æ£€æŸ¥æƒé™
sudo ./smart-forward --kernel-mode

# å¼ºåˆ¶ç”¨æˆ·æ€æ¨¡å¼
./smart-forward --user-mode
```

#### 2. ç«¯å£è¢«å ç”¨
**ç—‡çŠ¶**: `Address already in use`
```bash
# æŸ¥çœ‹ç«¯å£å ç”¨
sudo netstat -tulpn | grep :443
sudo lsof -i :443

# åœæ­¢å†²çªæœåŠ¡
sudo systemctl stop nginx  # ç¤ºä¾‹
```

#### 3. å¥åº·æ£€æŸ¥å¤±è´¥
**ç—‡çŠ¶**: æ‰€æœ‰ç›®æ ‡æ˜¾ç¤ºå¼‚å¸¸
```bash
# æ‰‹åŠ¨æµ‹è¯•è¿æ¥
telnet target.example.com 443
nc -zv target.example.com 443

# æ£€æŸ¥DNSè§£æ
nslookup target.example.com
dig target.example.com TXT
```

#### 4. é…ç½®æ–‡ä»¶é”™è¯¯
**ç—‡çŠ¶**: `é…ç½®æ–‡ä»¶è§£æå¤±è´¥`
```bash
# éªŒè¯YAMLè¯­æ³•
./start.sh                    # å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨éªŒè¯é…ç½®
./smart-forward --validate-config -c config.yaml

# ä½¿ç”¨ç¤ºä¾‹é…ç½®
cp config.yaml.example config.yaml
```

### æ—¥å¿—åˆ†æ
```bash
# å®æ—¶æŸ¥çœ‹æ—¥å¿—
# Linux:
sudo journalctl -u smart-forward -f

# OpenWrt:
logread -f | grep smart-forward

# æŸ¥çœ‹å¯åŠ¨æ—¥å¿—
# Linux:
sudo journalctl -u smart-forward --since "1 hour ago"

# OpenWrt:
logread | grep smart-forward | tail -20

# æŸ¥çœ‹é”™è¯¯å’Œè­¦å‘Š
logread | grep smart-forward | grep -E 'ERROR|WARN|é”™è¯¯'
```

### æ€§èƒ½ç›‘æ§
```bash
# æ£€æŸ¥è¿è¡ŒçŠ¶æ€
# OpenWrt:
ps w | grep smart-forward
nft list table inet smart_forward | grep dnat | wc -l  # è§„åˆ™æ•°é‡

# Linux:
systemctl status smart-forward
journalctl -u smart-forward --since "1 hour ago" | grep -E "INFO|ERROR"
```

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

---

**ğŸš€ ç«‹å³å¼€å§‹**: `curl -fsSL https://raw.githubusercontent.com/cls3389/smart-forward/main/install.sh | bash`
# ================================
# 智能网络转发器配置文件示例
# ================================
# 功能特性：
#   ✓ 支持TCP、UDP、HTTP协议转发
#   ✓ 动态地址解析与故障转移  
#   ✓ 实时DNS解析 (无缓存)
#   ✓ 健康检查与自动切换
#   ✓ 同端口多协议支持 (TCP+UDP)
#   ✓ HTTP自动跳转HTTPS
#   ✓ 内核态转发立即更新 (v1.5.3+)
# ================================

# 日志配置
logging:
  level: "info"      # 日志级别: debug/info/warn/error
  format: "text"     # 日志格式: json/text

# 网络配置
network:
  listen_addrs:
    - "192.168.1.100"    # 监听地址: 指定具体IP避免劫持
    # - "0.0.0.0"        # 监听所有接口 (不推荐用于生产环境)

# 全局默认缓冲区大小 (字节)
# 建议值: HTTP(4KB) | 一般应用(8KB) | 大文件传输(32KB)
buffer_size: 8192

# 全局动态更新配置
dynamic_update:
  check_interval: 5       # 健康检查间隔 (秒)
  connection_timeout: 3   # 连接超时 (秒)
  auto_reconnect: true    # 自动重连

# ================================
# 转发规则配置
# ================================
rules:
  # --------------------------------
  # HTTPS 服务转发 (443端口)
  # --------------------------------  
  - name: "HTTPS"
    listen_port: 443
    protocol: "tcp"           # 单TCP协议 (HTTPS标准)
    buffer_size: 4096         # 4KB缓冲区，适合Web请求
    targets:                  # 按优先级排序，支持故障转移
      - "192.168.1.10:443"         # 优先级1: 内网服务器
      - "backup.example.com:443"    # 优先级2: 外网备用
      - "dynamic.example.com"       # 优先级3: 动态域名(TXT记录)    
      
  # --------------------------------
  # RDP 服务转发 (3389端口)
  # 支持TCP+UDP双协议，适配STUN穿透
  # --------------------------------
  - name: "RDP"
    listen_port: 3389
    # 协议: 不指定时默认支持TCP+UDP双协议
    buffer_size: 16384        # 16KB缓冲区，适合RDP数据流
    targets:
      - "192.168.1.20:3389"        # 优先级1: 内网RDP服务器  
      - "rdp.example.com:3389"      # 优先级2: 外网RDP端口
      
  # --------------------------------
  # HTTP 服务转发 (8080端口) 
  # --------------------------------
  - name: "HTTP"
    listen_port: 8080
    protocol: "tcp"           # 单TCP协议 (HTTP)
    buffer_size: 8192         # 8KB缓冲区，适合Web请求
    targets:
      - "192.168.1.30:80"          # 优先级1: 内网Web服务器
      - "web.example.com:80"        # 优先级2: 外网Web服务器
      
  # --------------------------------
  # DNS 服务转发 (53端口)
  # 纯UDP协议，无健康检查，依赖DNS解析更新
  # --------------------------------
  - name: "DNS"
    listen_port: 53
    protocol: "udp"           # 单UDP协议 (DNS)
    buffer_size: 1024         # 1KB缓冲区，适合DNS查询
    targets:
      - "8.8.8.8:53"               # 优先级1: Google DNS
      - "dns.example.com:53"        # 优先级2: 动态DNS服务器

# ================================
# 配置说明：
# 1. 内网地址优先级最高，外网地址作为备用
# 2. 域名支持A/AAAA记录和TXT记录解析
# 3. TCP+UDP同端口是合理配置，适合RDP等协议
# 4. 缓冲区大小根据应用类型调优
# 5. 实时DNS解析，确保地址变化立即生效
# 6. v1.5.3+ 支持内核态转发立即更新
# 7. UDP规则DNS解析变化时自动更新DNAT规则 (v1.5.4+)
# ================================
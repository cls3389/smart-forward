# Docker é•œåƒå¤§å°å¯¹æ¯”åˆ†æ

## ğŸ“Š é•œåƒå¤§å°å¯¹æ¯”

| ç‰ˆæœ¬ | åŸºç¡€é•œåƒ | é¢„æœŸå¤§å° | ç‰¹ç‚¹ |
|------|----------|----------|------|
| **v1.0.x** | `debian:bullseye-slim` | ~80MB | åŸå§‹ç‰ˆæœ¬ï¼ŒåŠŸèƒ½å®Œæ•´ |
| **v1.1.0** | `gcr.io/distroless/cc-debian11` | ~20MB | ä¼˜åŒ–ç‰ˆæœ¬ï¼Œæœ€å°è¿è¡Œæ—¶ |
| **Alpine** | `alpine:3.18` | ~15MB | å°ä½“ç§¯ï¼ŒåŠŸèƒ½å®Œæ•´ |
| **Tiny** | `scratch` | ~5MB | è¶…å°ï¼Œé™æ€é“¾æ¥ |

## ğŸ” å¤§å°åˆ†æ

### ä¸ºä»€ä¹ˆåŸå§‹é•œåƒè¿™ä¹ˆå¤§ï¼Ÿ

1. **åŸºç¡€é•œåƒ**ï¼š
   - `debian:bullseye-slim` â‰ˆ 80MB
   - åŒ…å«å®Œæ•´çš„ Debian ç³»ç»Ÿ
   - åŒ…å«åŒ…ç®¡ç†å™¨ã€ç³»ç»Ÿå·¥å…·ç­‰

2. **è¿è¡Œæ—¶ä¾èµ–**ï¼š
   - `ca-certificates` åŒ…
   - ç³»ç»Ÿåº“æ–‡ä»¶
   - é…ç½®æ–‡ä»¶

3. **å¤šé˜¶æ®µæ„å»º**ï¼š
   - æ„å»ºé˜¶æ®µï¼š`rust:1.88-slim` â‰ˆ 800MB
   - è¿è¡Œæ—¶é˜¶æ®µï¼š`debian:bullseye-slim` â‰ˆ 80MB

### ä¼˜åŒ–ç­–ç•¥

#### 1. ä½¿ç”¨æ›´å°çš„åŸºç¡€é•œåƒ
```dockerfile
# ä» 80MB å‡å°‘åˆ° 20MB
FROM gcr.io/distroless/cc-debian11
```

#### 2. é™æ€é“¾æ¥
```dockerfile
# ä»åŠ¨æ€é“¾æ¥å‡å°‘åˆ°é™æ€é“¾æ¥
ENV RUSTFLAGS="-C target-cpu=native -C link-arg=-s"
```

#### 3. ç§»é™¤ä¸å¿…è¦æ–‡ä»¶
```dockerfile
# åªä¿ç•™äºŒè¿›åˆ¶æ–‡ä»¶
COPY --from=builder /app/target/release/smart-forward /smart-forward
```

## ğŸš€ æ¨èä½¿ç”¨

### ç”Ÿäº§ç¯å¢ƒ
- **æ¨è**ï¼š`Dockerfile` (distroless) - 20MB
- **åŸå› **ï¼šå®‰å…¨ã€å°ã€ç¨³å®š

### å¼€å‘ç¯å¢ƒ
- **æ¨è**ï¼š`Dockerfile.alpine` - 15MB
- **åŸå› **ï¼šåŠŸèƒ½å®Œæ•´ã€å¯è°ƒè¯•

### æè‡´ä¼˜åŒ–
- **æ¨è**ï¼š`Dockerfile.tiny` - 5MB
- **åŸå› **ï¼šæœ€å°ä½“ç§¯ã€é™æ€é“¾æ¥

## ğŸ“ˆ ä¼˜åŒ–æ•ˆæœ

- **v1.0.x**: 80MB (100%)
- **v1.1.0**: 20MB (25%) - å‡å°‘ 75%
- **Alpine**: 15MB (19%) - å‡å°‘ 81%
- **Tiny**: 5MB (6%) - å‡å°‘ 94%

## ğŸ”§ ä½¿ç”¨å»ºè®®

1. **é»˜è®¤ä½¿ç”¨**ï¼š`Dockerfile` (distroless)
2. **éœ€è¦è°ƒè¯•**ï¼š`Dockerfile.alpine`
3. **æè‡´ä¼˜åŒ–**ï¼š`Dockerfile.tiny`
4. **CI/CD**ï¼šæ ¹æ®éœ€æ±‚é€‰æ‹©åˆé€‚ç‰ˆæœ¬

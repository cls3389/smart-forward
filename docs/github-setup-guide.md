# ğŸš€ GitHub å®Œæ•´é…ç½®æŒ‡å—

## ğŸ“‹ **æ¦‚è¿°**

æœ¬æŒ‡å—åŒ…å«GitHub Actionså’ŒContainer Registryçš„å®Œæ•´é…ç½®ï¼Œè§£å†³å¸¸è§çš„æƒé™é—®é¢˜ã€‚

## ğŸš¨ **å¸¸è§é”™è¯¯å¿«é€Ÿä¿®å¤**

### 403 Forbidden é”™è¯¯
å¦‚æœé‡åˆ°ä»¥ä¸‹é”™è¯¯ï¼š
```
ERROR: failed to push ghcr.io/cls3389/smart-forward:v1.0.0: 
unexpected status from HEAD request: 403 Forbidden
```

**å¿«é€Ÿè§£å†³æ–¹æ¡ˆ**ï¼š
1. GitHub â†’ æ‚¨çš„å¤´åƒ â†’ **Your profile** â†’ **Packages**
2. æ‰¾åˆ° `smart-forward` åŒ… (å¦‚æœå­˜åœ¨) â†’ **Package settings** 
3. æ»šåŠ¨åˆ°åº•éƒ¨ â†’ **Delete package** â†’ ç¡®è®¤åˆ é™¤
4. é‡æ–°æ¨é€tagè§¦å‘æ„å»ºï¼š`git tag v1.2.4 && git push origin v1.2.4`

---

## ğŸ”§ **ç¬¬ä¸€æ­¥: å¯ç”¨ GitHub Actions**

### 1.1 è¿›å…¥ä»“åº“è®¾ç½®
1. æ‰“å¼€æ‚¨çš„GitHubä»“åº“é¡µé¢
2. ç‚¹å‡» **Settings** (è®¾ç½®) æ ‡ç­¾
3. åœ¨å·¦ä¾§èœå•æ‰¾åˆ° **Actions** â†’ **General**

### 1.2 å¯ç”¨Actionsæƒé™
```
âœ… Allow all actions and reusable workflows
```
æˆ–è€…é€‰æ‹©ï¼š
```
âœ… Allow [your organization] actions and reusable workflows
```

### 1.3 å·¥ä½œæµæƒé™è®¾ç½®
åœ¨åŒä¸€é¡µé¢æ‰¾åˆ° **Workflow permissions**ï¼š
```
âœ… Read and write permissions
âœ… Allow GitHub Actions to create and approve pull requests
```

---

## ğŸ³ **ç¬¬äºŒæ­¥: é…ç½® Container Registry æƒé™**

### 2.1 åŒ…æƒé™è®¾ç½®
1. è¿›å…¥ **Settings** â†’ **Actions** â†’ **General**
2. æ‰¾åˆ° **Workflow permissions** éƒ¨åˆ†
3. ç¡®ä¿é€‰æ‹©äº†ï¼š
   ```
   âœ… Read and write permissions
   ```

### 2.2 ä¸ªäººè®¿é—®ä»¤ç‰Œ (å¯é€‰ï¼Œæ¨èç”¨å†…ç½®TOKEN)
å¦‚æœä½¿ç”¨å†…ç½®çš„ `GITHUB_TOKEN` ä¸å¤Ÿï¼Œå¯ä»¥åˆ›å»ºä¸ªäººä»¤ç‰Œï¼š

1. ç‚¹å‡»å³ä¸Šè§’å¤´åƒ â†’ **Settings**
2. å·¦ä¾§èœå• â†’ **Developer settings** â†’ **Personal access tokens** â†’ **Tokens (classic)**
3. ç‚¹å‡» **Generate new token (classic)**
4. è®¾ç½®æƒé™ï¼š
   ```
   âœ… repo (å®Œæ•´ä»“åº“æƒé™)
   âœ… write:packages (åŒ…å†™å…¥æƒé™)
   âœ… read:packages (åŒ…è¯»å–æƒé™)
   ```
5. å¤åˆ¶ç”Ÿæˆçš„ä»¤ç‰Œ

### 2.3 æ·»åŠ Secret (å¦‚æœä½¿ç”¨ä¸ªäººä»¤ç‰Œ)
1. å›åˆ°ä»“åº“ â†’ **Settings** â†’ **Secrets and variables** â†’ **Actions**
2. ç‚¹å‡» **New repository secret**
3. åç§°: `GHCR_TOKEN`
4. å€¼: ç²˜è´´åˆšæ‰å¤åˆ¶çš„ä»¤ç‰Œ

---

## ğŸ“¦ **ç¬¬ä¸‰æ­¥: éªŒè¯é…ç½®**

### 3.1 æ£€æŸ¥æƒé™
åœ¨ä»“åº“è®¾ç½®ä¸­ç¡®è®¤ï¼š
- âœ… Actions å·²å¯ç”¨
- âœ… å·¥ä½œæµæœ‰è¯»å†™æƒé™
- âœ… å¯ä»¥åˆ›å»ºå’Œæ‰¹å‡†PR

### 3.2 æµ‹è¯•æ„å»º
1. ä¿®æ”¹ä»»æ„æºä»£ç æ–‡ä»¶
2. æäº¤å¹¶æ¨é€åˆ° `main` åˆ†æ”¯
3. æŸ¥çœ‹ **Actions** æ ‡ç­¾é¡µï¼Œåº”è¯¥çœ‹åˆ°CIå·¥ä½œæµè¿è¡Œ

### 3.3 æµ‹è¯•å‘å¸ƒ
1. åˆ›å»ºç‰ˆæœ¬æ ‡ç­¾ï¼š
   ```bash
   git tag v1.0.0
   git push --tags
   ```
2. æŸ¥çœ‹ **Actions** æ ‡ç­¾é¡µï¼Œåº”è¯¥çœ‹åˆ°å‘å¸ƒå·¥ä½œæµè¿è¡Œ
3. æ„å»ºå®Œæˆåï¼Œæ£€æŸ¥ï¼š
   - **Releases** é¡µé¢æœ‰æ–°ç‰ˆæœ¬
   - **Packages** é¡µé¢æœ‰Dockeré•œåƒ

---

## ğŸš¨ **å¸¸è§é—®é¢˜æ’æŸ¥**

### é—®é¢˜1: "Permission denied" é”™è¯¯
**ç—‡çŠ¶**: Actionsè¿è¡Œå¤±è´¥ï¼Œæ˜¾ç¤ºæƒé™è¢«æ‹’ç»
**è§£å†³**: 
1. æ£€æŸ¥ **Workflow permissions** æ˜¯å¦è®¾ç½®ä¸º "Read and write"
2. ç¡®ä¿Actionså·²å¯ç”¨

### é—®é¢˜2: Dockeræ¨é€å¤±è´¥
**ç—‡çŠ¶**: Dockeré•œåƒæ„å»ºæˆåŠŸä½†æ¨é€å¤±è´¥
**è§£å†³**:
1. æ£€æŸ¥æ˜¯å¦æœ‰ `write:packages` æƒé™
2. ç¡®è®¤ä»“åº“åç§°æ­£ç¡® (å°å†™)

### é—®é¢˜3: Releaseåˆ›å»ºå¤±è´¥
**ç—‡çŠ¶**: äºŒè¿›åˆ¶æ–‡ä»¶æ„å»ºæˆåŠŸä½†Releaseåˆ›å»ºå¤±è´¥
**è§£å†³**:
1. æ£€æŸ¥æ˜¯å¦æœ‰ `contents: write` æƒé™
2. ç¡®è®¤æ ‡ç­¾æ ¼å¼æ­£ç¡® (vå¼€å¤´)

### é—®é¢˜4: æ„å»ºè¶…æ—¶
**ç—‡çŠ¶**: æ„å»ºè¿è¡Œå¾ˆé•¿æ—¶é—´åè¶…æ—¶
**è§£å†³**:
1. æ£€æŸ¥ç½‘ç»œè¿æ¥
2. æŸ¥çœ‹æ˜¯å¦æœ‰ä¾èµ–ä¸‹è½½é—®é¢˜
3. è€ƒè™‘å¢åŠ è¶…æ—¶æ—¶é—´

---

## ğŸ¯ **å¿«é€Ÿæ£€æŸ¥æ¸…å•**

åœ¨å¼€å§‹æ„å»ºå‰ï¼Œè¯·ç¡®è®¤ï¼š

- [ ] âœ… GitHub Actions å·²å¯ç”¨
- [ ] âœ… å·¥ä½œæµæƒé™è®¾ç½®ä¸º "Read and write"  
- [ ] âœ… å…è®¸Actionsåˆ›å»ºå’Œæ‰¹å‡†PR
- [ ] âœ… ä»“åº“åç§°æ˜¯å°å†™ (Dockerè¦æ±‚)
- [ ] âœ… æœ‰ `.github/workflows/` ç›®å½•å’Œå·¥ä½œæµæ–‡ä»¶
- [ ] âœ… `Cargo.toml` å’Œ `Dockerfile` å­˜åœ¨

---

## ğŸ“ **è·å–å¸®åŠ©**

å¦‚æœé‡åˆ°é—®é¢˜ï¼š

1. **æŸ¥çœ‹Actionsæ—¥å¿—**: ç‚¹å‡»å¤±è´¥çš„å·¥ä½œæµï¼ŒæŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯
2. **æ£€æŸ¥æƒé™**: æŒ‰ç…§æœ¬æŒ‡å—é‡æ–°æ£€æŸ¥æ‰€æœ‰æƒé™è®¾ç½®
3. **æŸ¥çœ‹ç¤ºä¾‹**: å‚è€ƒæˆåŠŸçš„å¼€æºé¡¹ç›®é…ç½®
4. **ç¤¾åŒºæ±‚åŠ©**: åœ¨GitHub Discussionsæˆ–ç›¸å…³ç¤¾åŒºæé—®

---

## ğŸ‰ **æˆåŠŸæ ‡å¿—**

é…ç½®æˆåŠŸåï¼Œæ‚¨åº”è¯¥çœ‹åˆ°ï¼š

1. **CIå·¥ä½œæµ**: æ¯æ¬¡æ¨é€ä»£ç æ—¶è‡ªåŠ¨è¿è¡Œ
2. **å‘å¸ƒå·¥ä½œæµ**: æ¨é€æ ‡ç­¾æ—¶è‡ªåŠ¨æ„å»ºæ‰€æœ‰å¹³å°
3. **Dockeré•œåƒ**: åœ¨Packagesé¡µé¢å¯ä»¥çœ‹åˆ°
4. **Releaseé¡µé¢**: æœ‰äºŒè¿›åˆ¶æ–‡ä»¶ä¸‹è½½é“¾æ¥

æ­å–œï¼æ‚¨çš„è‡ªåŠ¨åŒ–æ„å»ºå’Œå‘å¸ƒç³»ç»Ÿå·²ç»é…ç½®å®Œæˆï¼ğŸŠ
